---
date: 2022-06-19 09:54:04
categories: 
 - DB
 - Redis
tags: 
 - Redis热Key
---

#  Redis热Key

## 一、什么是热Key

> 在Redis中，我们把访问频率高的key,称为热key。比如突然 有几十万的请求去访问redis中某个特定的key,那么这样会造成redis服务器短时间流量过于集中，很可能导致redis的服务器宕机。那么接下来对这个key的请求，都会直接请求到我们的后端数据库中，从而可能导致后端服务不可用。

<!--more-->

## 二、热Key产生的原因

1. 用户消费的数据远大于生产的数据，如秒杀、 热点新闻、 热点评论等读多写少的场景。
2. 请求分片集中，超过单台redis服务器的性能极限。
   - 在服务端读数据进行访问时，往往会对数据进行分片切分，例如采用固定Hash分片，hash落入同一台redis服务器，如果瞬间访问量极大，超过机器瓶颈时，就会导致热点Key问题的产生。

## 三、热点Key的危害

1. 缓存击穿，压垮redis服务器，导致大量请求直接发往后端服务，并且DB本身性能较弱，很可能进一步导致服务雪崩。

## 四、如何识别热点Key

1.  凭借个人经验，结合业务场景，判断哪些是热点Key
   - 比如，双十一大促的时候，苹果手机正在秒杀，那么我们可以判断苹果手机这个sku就是热key.
2. 使用redis之前，统计上报
   - 修改我们的业务代码，在操作redis之前，加入key使用次数的统计逻辑，定时把收集到的数据上报到统一的服务进行聚合计算，这样我们就可以找到那些热点key。缺点就是对我们的业务代码有一定的侵入性。
3.  服务代理层上报
   - ![image-20220619204410712](https://gcore.jsdelivr.net/gh/znej/pic/picgo/image-20220619204410712.png)
4. 使用redis提供的命令
   - 例如monitor、 redis-cli加上hotkeys选项等，不过这种方式执行起来很慢，可能会降低redis的处理请求的性能，慎用
5. redis节点抓包分析

## 五、如何解决热Key问题

1. Redis集群扩容：增加分片副本，分摊客户端发过来的读请求
2. 使用二级缓存，即JVM本地缓存，减少redis的读请求
   - 例如使用Caffeine+redis实现二级缓存，先从本地缓存中取，取不到再去redis中去取。