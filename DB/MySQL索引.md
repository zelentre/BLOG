---
title: MySQL索引
date: 2022-03-07 18:28:26
categories: 
 - DB
 - MySQL
tags: 
 - MySQL索引
---
# MySQL索引

> **索引是对数据库表中一列或多列的值进行排序的一种结构。MySQL索引的建立对于MySQL的高效运行是很重要的，索引可以大大提高MySQL的检索速度。**索引只是提高效率的一个因素，如果你的MySQL有大数据量的表，就需要花时间研究建立最优秀的索引，或优化查询语句。
>
> 📌简单类比一下，数据库如同书籍，索引如同数据目录，假如我们需要从书籍查找与xx相关的内容，我们可以直接从目录中查找，定位到xx内容所在页面，如果目录中没有xx相关字符或者没有设置目录（索引），那就只能逐字逐页阅读文本查找，效率可想而知。

## 1. 索引的优缺点

> 索引可以大大提高MySQL的检索速度，为什么不对表中的每一个列创建一个索引呢？

### 1.1. 优点

- **索引大大减小了服务器需要扫描的数据量，从而大大加快数据的检索速度，这也是创建索引的最主要原因**
-   **索引可以帮助服务器避免排序和创建临时表**
- **索引可以将随机IO变成顺序IO**
- 索引可以对于InnoDB（对索引支持行级锁）非常重要，因为它可以让查询锁更少的元组，提高了表访问并发性
- 关于InnoDB、索引和锁：InnoDB在二级索引上使用共享锁（读锁），但访问主键索引需要排他锁（写锁）
- 通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性
- 可以加速表与表之间的连接，特别是在实现数据的参考完整性方面特别有意义
- 在使用分组和排序子句进行数据检索时，同样可以显著减少查询中分组和排序的时间
- 通过使用索引，可以在查询的过程中，使用优化隐藏器，提高系统的性能

### 1.2. 缺点
- 创建索引和维护索引要**消耗时间**，这种时间随着数据量的增加而增加
- 索引需要占**物理空间**，除了数据表占用数据空间之外，每一个索引还要占用一定的物理空间，如果需要建立聚簇索引，那么需要占用的空间会更大
- 对表中的数据进行增、删、改的时候，索引也要动态的维护，这就降低了整数的维护速度
-  如果某个数据列包含许多重复的内容，为它建立索引就没有太大的实际效果
- 对于非常小的表，大部分情况下建单的全表扫描更高效
## 2. 创建索引准则
> 索引是建立在数据库表中的某些列的上面。因此，在创建索引的时候，应该仔细考虑在那些列上可以创建索引，在那些列上不能创建索引。

### 2.1. 应该创建索引的列

- 在**经常需要搜索的列**上，可以加快搜索的速度
- 在作为**主键的列**上，强制该列的唯一性和组织表中数据的排列结构
- 在**经常用在连接（JOIN）的列上**，这些列主要是一些外键，可以加快连接的速度
- 在**经常需要根据范围（<, <=, =, >, >=, BETWEEN, IN）进行搜索的列**上创建索引，因为索引已经排序，其指定的范围是连续的
- 在**经常需要排序的（ORDER BY）的列**上创建索引，因为索引已经排序，这样查询可以利用索引的排序，加快排序查询时间
- 在**经常使用WHERE子句中的列**上创建索引，加快条件的判断速度

### 2.2. 不该创建索引的列

- 对于那些在查询中**很少使用或者参考的列**不应该创建索引。若列很少使用到，因此有索引或者无索引，并不能提高查询速度。相反，由于增加了索引，反而降低了系统的维护速度和增大了空间需求
- 对于那些只有**很少数据值或者重复值多的列**也不应该增加索引。这些列的取值很少，例如人事表的性别列，在查询的结果中，结果集的数据行占了表中数据行的很大比例，即需要在表中搜索的数据行的比例很大。增加索引，并不能明显加快检索速度
- 对于那些定义为**text, image和bit数据类型的列**不应该增加索引。这些列的数据量要么相当大，要么取值很少
- 当该列**修改性能要求远远高于检索性能**时，不应该创建索引。（修改性能和检索性能是相互矛盾的）

## 3. 索引结构

> MySQL中常用的索引结构（索引底层的数据结构）有：B-TREE ，B+TREE ，HASH 等。

### 3.1. B-Tree

**B-树就是B树，多路搜索树，树高一层意味着多一次的磁盘I/O**，下图是3阶B树

![B-树](https://gitee.com/zelen/IMG/raw/master/PicGo/2021013023233065.png)

B树的特征：

- **关键字集合分布在整棵树中**
- 任何一个关键字出现且只出现在一个节点中
- **搜索有可能在非叶子节点结束**
- 其搜索性能等价于关键字全集内做一次二分查找
- 自动层次控制

### 3.2. B+TREE

> B+树是B-树的变体，也是一种多路搜索树

![B+树](https://gitee.com/zelen/IMG/raw/master/PicGo/20210130232533425.png)

B+树的特征：

- 
